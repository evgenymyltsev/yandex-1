# Задание 1 — найди ошибки

В этом репозитории находятся материалы тестового задания "Найди ошибки" для [14-й Школы разработки интерфейсов](https://academy.yandex.ru/events/frontend/shri_msk-2018-2) (осень 2018, Москва, Санкт-Петербург, Симферополь).

Для работы тестового приложения нужен Node.JS v9. В проекте используются [Yandex Maps API](https://tech.yandex.ru/maps/doc/jsapi/2.1/quick-start/index-docpage/) и [ChartJS](http://www.chartjs.org).

## Задание

Код содержит ошибки разной степени критичности. Некоторые из них — стилистические, а другие — даже не позволят вам запустить приложение. Вам нужно найти все ошибки и исправить их.

Пункты для самопроверки:

1.  Приложение должно успешно запускаться.
2.  По адресу http://localhost:9000 должна открываться карта с метками.
3.  Должна правильно работать вся функциональность, перечисленная в условиях задания.
4.  Не должно быть лишнего кода.
5.  Все должно быть в едином codestyle.

## Запуск

```
npm i
npm start
```

При каждом запуске тестовые данные генерируются заново случайным образом.

```
1.  Разный стиль кода.
    Проблема: код пишется не в одном стиле, похоже, код писали несколько разработчиков, каждый разработчик на свой вкус понимает как писать “лучше и красивее”.
    Решение: подключен стандартизатор стиля кода prettier

2.  Нет favicon.
    Проблема: Failed to load resource: the server responded with a status of 404 (Not Found) favicon.
    Решение: В папку public добавлен файл favicon.ico, в index.html добавлен <link rel="shortcut icon" href="favicon.ico">

3.  Устаревший синтаксис.
    Проблема: в проекте используются объявление переменных через var и объявление функций через function() {}, там, где это можно сделать через () => {}.
    Решение: внимательно изучил файлы проекта, заменил var на const, где переменные не изменяются и на let, где могут измениться. Объявление function() {} заменено на () => {} там, где это не приводит к потере контекста.

4.  Неправильный импорт.
    Проблема: при инициализации карты возникает ошибка Uncaught TypeError: Object(...) is not a function at ymaps.ready.
    Решение: ошибка в импорте модуля, в этом случае его просто нет. В файле index.js import модуля без { } допускается только, если модуль экспортируется как default, во всех других случаях нужно ставить { }. Поэтому initMap из map.js экспортирован по умолчанию.

5.  Нет маркеров на карте.
    Проблема: маркеры базовых станций не отображаются на карте.
    Решение: данные в ответе от сервера приходят, добавляются в objectManager через objectManager.objects.add(data), но нет инитциализации геометок на самой карте. Метки добавлены на карту с помощью myMap.geoObjects.add(objectManager).

6.  Метки отображаются в Казахстане.
    Проблема: метки отображаются в Казахстане, а не в Москве, хотя координаты в ответе с серевера приходят корректные.
    Решение: нормализация данных в файле mapper.js с сервера выполнена с ошибкой: coordinates: [obj.long, obj.lat], первым элементом массива нужно передавать lat, вторым long.

7.  Кластеры не показывают наличие неисправных станций.
    Проблема: кластеры отображаются зеленым цветом и не несут информации о том, что в кластере есть неисправные станции, хотя в классе указан параметр clusterIconLayout: 'default#pieChart'.
    Решение: objectManager.clusters.options.set('preset', 'islands#greenClusterIcons') перекрывает параметр clusterIconLayout: 'default#pieChart', поэтому необходимо убрать objectManager.clusters.options.set('preset', 'islands#greenClusterIcons') из кода.

8.  Не открывается Balloon при клике на базовую станцию.
    Проблема: По клику на станцию появлялась ошибка TypeError: Cannot read property 'destroy' of null.
    Решение: Ошибка возникала из-за того, что при вызове методов объекта, обявленных через стрелочную функцию, this не указвыал на объект, на котором произошло событие, а равнялся undefined. Поэтому стрелочные функции в файле details.js были заменены на function() {}.

9.  Нет данных на графиках.
    Проблема: на графиках нет данных.
    Решение: максимальное значение yAxes.ticks.max ограничено 0, значения выше этого не отображаются на графике. Т.к. в требованиямх не укзано, каким значением должен быть ограничен график, максимальное значение ограничивается динамически с помощью Math.max() и spread оператором для удобства пользователя.
    yAxes: [
        {
            ticks: {
                beginAtZero: true,
                max: Math.max(...data)
            }
        }
    ]
```
